# ç¤¾å€æ„Ÿæ¸¬å™¨è³‡æ–™ä¸Šå‚³å¹³å° - å®Œæ•´æ“ä½œæ‰‹å†Š

## ğŸ“‹ ç›®éŒ„

- [å°ˆæ¡ˆæ¦‚è¿°](#å°ˆæ¡ˆæ¦‚è¿°)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [åŠŸèƒ½ç‰¹è‰²](#åŠŸèƒ½ç‰¹è‰²)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [è©³ç´°å®‰è£æŒ‡å—](#è©³ç´°å®‰è£æŒ‡å—)
- [ç³»çµ±å•Ÿå‹•](#ç³»çµ±å•Ÿå‹•)
- [API æ–‡æª”](#api-æ–‡æª”)
- [ä½¿ç”¨ç¯„ä¾‹](#ä½¿ç”¨ç¯„ä¾‹)
- [æ•ˆèƒ½å„ªåŒ–](#æ•ˆèƒ½å„ªåŒ–)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)

---

## å°ˆæ¡ˆæ¦‚è¿°

é€™æ˜¯ä¸€å€‹å®Œæ•´çš„ç¤¾å€æ„Ÿæ¸¬å™¨è³‡æ–™ä¸Šå‚³å¹³å°ï¼ŒåŒ…å«å¾Œç«¯å¼•æ“ã€å‰ç«¯å„€è¡¨æ¿å’Œæ•¸æ“šæ¨¡æ“¬å™¨ã€‚ç³»çµ±èƒ½å¤ æ™ºèƒ½è™•ç†æ„Ÿæ¸¬å™¨æ•¸æ“šçš„ä¸Šå‚³å„ªå…ˆç´šï¼Œä¸¦æä¾›å³æ™‚ç›£æ§å’Œå ±è¡¨åŠŸèƒ½ã€‚

### æŠ€è¡“æ£§

- **å¾Œç«¯**: Node.js + Express
- **å‰ç«¯**: React + Vite + ECharts
- **æ¨¡æ“¬å™¨**: Python
- **è³‡æ–™åº«**: JSON æª”æ¡ˆæŒä¹…åŒ–ï¼ˆlowdb é¢¨æ ¼ï¼‰
- **æ•ˆèƒ½å„ªåŒ–**: å¿«å–æ©Ÿåˆ¶ã€éåŒæ­¥è™•ç†ã€æ¼”ç®—æ³•å„ªåŒ–

---

## ç³»çµ±æ¶æ§‹

**âœ… ç¬¦åˆç°¡å ±ç¬¬ 4 é æ¶æ§‹åœ–**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨¡æ“¬å™¨         â”‚ â”€â”€â”€â”€â”€â”€> â”‚   å¾Œç«¯ API      â”‚ <â”€â”€â”€â”€â”€â”€ â”‚   å‰ç«¯          â”‚
â”‚ simulator_       â”‚  POST   â”‚  (Node.js)      â”‚  GET    â”‚  (React)        â”‚
â”‚ backend.py      â”‚         â”‚                 â”‚         â”‚  frontend/src/  â”‚
â”‚ âœ… ç¬¦åˆæ¶æ§‹      â”‚         â”‚  âœ… ç¬¦åˆæ¶æ§‹     â”‚         â”‚  App.jsx        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  å„ªå…ˆç´šå¼•æ“     â”‚ âœ… å·²å¯¦ä½œ
                            â”‚  priorityEngine â”‚
                            â”‚  ä¸Šå‚³èª¿åº¦å™¨     â”‚ âœ… å·²å¯¦ä½œ
                            â”‚  uploadSchedulerâ”‚
                            â”‚  å¿«å–æœå‹™       â”‚ âœ… å·²å¯¦ä½œ
                            â”‚  cacheService   â”‚
                            â”‚  è³‡æ–™åº«æœå‹™     â”‚ âœ… å·²å¯¦ä½œ
                            â”‚  databaseServiceâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  JSON è³‡æ–™åº«    â”‚
                            â”‚  data/          â”‚
                            â”‚  sensor-data.jsonâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒçµ„ä»¶

1. **å¾Œç«¯å¼•æ“** (`server.js`)
   - RESTful API æœå‹™
   - å„ªå…ˆç´šåˆ¤å®šå¼•æ“
   - ä¸Šå‚³èª¿åº¦å™¨
   - å¿«å–æ©Ÿåˆ¶
   - æ•ˆèƒ½ç›£æ§

2. **å‰ç«¯å„€è¡¨æ¿** (`frontend/`)
   - React æ‡‰ç”¨ç¨‹å¼
   - å³æ™‚æ•¸æ“šé¡¯ç¤º
   - åœ–è¡¨è¦–è¦ºåŒ–
   - æ•¸æ“šä¸Šå‚³ä»‹é¢

3. **æ•¸æ“šæ¨¡æ“¬å™¨** (`tests/simulator_backend.py`)
   - è‡ªå‹•ç”Ÿæˆæ„Ÿæ¸¬å™¨æ•¸æ“š
   - æ”¯æ´å¤šç¨®æ¸¬è©¦å ´æ™¯
   - æŒçºŒé‹è¡Œæ¨¡å¼

---

## åŠŸèƒ½ç‰¹è‰²

### âœ… ç¬¬ä¸€éšæ®µï¼šåŸºç¤æ¶æ§‹èˆ‡ API å®šç¾©

- Node.js + Express ä¼ºæœå™¨ç’°å¢ƒ
- RESTful API è¨­è¨ˆ
  - **è¼¸å…¥ç«¯**ï¼šæ¥æ”¶æ„Ÿæ¸¬å™¨æ•¸æ“šï¼ˆPOST /api/sensors/dataï¼‰
  - **è¼¸å‡ºç«¯**ï¼šæä¾›æ•¸æ“šæŸ¥è©¢èˆ‡å ±è¡¨ï¼ˆGET /api/sensors/data, GET /api/reports/*ï¼‰

### âœ… ç¬¬äºŒéšæ®µï¼šå„ªå…ˆç´šåˆ¤å®šå¼•æ“

- **å„ªå…ˆç´šè¨ˆç®—æ¼”ç®—æ³•**
  - æ ¹æ“šä¸‰å€‹æ¬Šé‡è¨ˆç®—å„ªå…ˆç´šåˆ†æ•¸ï¼ˆ0-10ï¼‰ï¼š
    - è³‡æ–™é‡è¦æ€§ (Data Importance) - æ¬Šé‡ 0.5
    - ç¯€é»ç‹€æ…‹ (Battery) - æ¬Šé‡ 0.3
    - ç¶²è·¯ç‹€æ³ (Network Status) - æ¬Šé‡ 0.2
  
- **ä¸Šå‚³èª¿åº¦å™¨ (Upload Scheduler)**
  - **Preemptive (æ¶ä½”å¼)**ï¼šç·Šæ€¥è³‡æ–™æ’éšŠæ©Ÿåˆ¶ï¼Œç¢ºä¿é—œéµè³‡æ–™å„ªå…ˆé€é”
  - **Batch (æ‰¹æ¬¡)**ï¼šéç·Šæ€¥è³‡æ–™æ‰“åŒ…ä¸€èµ·é€ï¼Œç¯€çœè³‡æº

### âœ… ç¬¬ä¸‰éšæ®µï¼šå‰ç«¯ã€æ¨¡æ“¬å™¨ã€å¾Œç«¯é€£æ¥

- çµ±ä¸€ JSON æ ¼å¼è¦ç¯„
- æ¨¡æ“¬å™¨è‡ªå‹•ç”Ÿæˆæ•¸æ“š
- å‰ç«¯å³æ™‚ç›£æ§å„€è¡¨æ¿
- å®Œæ•´æ•¸æ“šæµç¨‹

### âœ… ç¬¬å››éšæ®µï¼šæ•ˆèƒ½å„ªåŒ–

- **å¿«å–æ©Ÿåˆ¶**ï¼šæ¸›å°‘è³‡æ–™åº«è®€å–æ¬¡æ•¸ï¼Œæå‡å›æ‡‰é€Ÿåº¦
- **éåŒæ­¥è™•ç†**ï¼šå„ªå…ˆç´šè¨ˆç®—ä¸é˜»å¡ä¸»ç·šç¨‹ï¼Œæå‡ååé‡
- **æ¼”ç®—æ³•å„ªåŒ–**ï¼šé™ä½é‹ç®—æˆæœ¬ï¼Œæå‡è¨ˆç®—æ•ˆç‡
- **æ•ˆèƒ½ç›£æ§**ï¼šå³æ™‚ç›£æ§ç³»çµ±æ•ˆèƒ½æŒ‡æ¨™

---

## å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- **Node.js** >= 14.0.0
- **Python** >= 3.7
- **npm** æˆ– **yarn**

### 1. å®‰è£ä¾è³´

```bash
# å¾Œç«¯ä¾è³´
npm install

# å‰ç«¯ä¾è³´
cd frontend
npm install
cd ..
```

### 2. å•Ÿå‹•ç³»çµ±

**çµ‚ç«¯ 1ï¼šå•Ÿå‹•å¾Œç«¯**
```bash
npm start
```

**çµ‚ç«¯ 2ï¼šå•Ÿå‹•å‰ç«¯**
```bash
cd frontend
npm run dev
```

**çµ‚ç«¯ 3ï¼šé‹è¡Œæ¨¡æ“¬å™¨ï¼ˆå¯é¸ï¼‰**
```bash
python tests/simulator_backend.py --continuous
```

### 3. è¨ªå•ç³»çµ±

- **å‰ç«¯å„€è¡¨æ¿**: http://localhost:5173
- **å¾Œç«¯ API**: http://localhost:3000
- **API æ–‡æª”**: http://localhost:3000/
- **å¥åº·æª¢æŸ¥**: http://localhost:3000/health

---

## è©³ç´°å®‰è£æŒ‡å—

### ç’°å¢ƒæª¢æŸ¥

```bash
# æª¢æŸ¥ Node.js ç‰ˆæœ¬
node --version

# æª¢æŸ¥ Python ç‰ˆæœ¬
python --version

# æª¢æŸ¥ npm ç‰ˆæœ¬
npm --version
```

### å®Œæ•´å®‰è£æ­¥é©Ÿ

#### æ­¥é©Ÿ 1ï¼šå…‹éš†æˆ–ä¸‹è¼‰å°ˆæ¡ˆ

```bash
cd "c:\CSIE\computer network\final_project"
```

#### æ­¥é©Ÿ 2ï¼šå®‰è£å¾Œç«¯ä¾è³´

```bash
npm install
```

é€™æœƒå®‰è£ä»¥ä¸‹å¥—ä»¶ï¼š
- `express` - Web æ¡†æ¶
- `cors` - è·¨åŸŸæ”¯æ´
- `body-parser` - è«‹æ±‚è§£æ
- `dotenv` - ç’°å¢ƒè®Šæ•¸

#### æ­¥é©Ÿ 3ï¼šå®‰è£å‰ç«¯ä¾è³´

```bash
cd frontend
npm install
cd ..
```

é€™æœƒå®‰è£ä»¥ä¸‹å¥—ä»¶ï¼š
- `react` - UI æ¡†æ¶
- `react-dom` - React DOM æ¸²æŸ“
- `echarts` - åœ–è¡¨åº«
- `vite` - æ§‹å»ºå·¥å…·
- `tailwindcss` - CSS æ¡†æ¶

#### æ­¥é©Ÿ 4ï¼šå®‰è£ Python ä¾è³´ï¼ˆæ¨¡æ“¬å™¨ï¼‰

```bash
pip install requests
```

---

## ç³»çµ±å•Ÿå‹•

### å•Ÿå‹•æ–¹å¼

#### æ–¹å¼ä¸€ï¼šæ¨™æº–å•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰

**1. å•Ÿå‹•å¾Œç«¯ä¼ºæœå™¨**

```bash
# é–‹ç™¼æ¨¡å¼ï¼ˆè‡ªå‹•é‡å•Ÿï¼‰
npm run dev

# ç”Ÿç”¢æ¨¡å¼
npm start
```

**é æœŸè¼¸å‡ºï¼š**
```
ğŸš€ ä¼ºæœå™¨é‹è¡Œæ–¼ http://localhost:3000
ğŸ“Š API æ–‡æª”: http://localhost:3000/
â¤ï¸  å¥åº·æª¢æŸ¥: http://localhost:3000/health
```

**2. å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨**

```bash
cd frontend
npm run dev
```

**é æœŸè¼¸å‡ºï¼š**
```
  VITE v5.x.x  ready in xxx ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
```

**3. é‹è¡Œæ¨¡æ“¬å™¨ï¼ˆå¯é¸ï¼‰**

```bash
# æŒçºŒé‹è¡Œæ¨¡å¼ï¼ˆè‡ªå‹•ç”Ÿæˆæ•¸æ“šï¼‰
python tests/simulator_backend.py --continuous

# é‹è¡ŒæŒ‡å®šæ™‚é–“ï¼ˆä¾‹å¦‚ 60 ç§’ï¼‰
python tests/simulator_backend.py --continuous --duration 60

# å›ºå®šæ•¸é‡æ¨¡å¼
python tests/simulator_backend.py --sensors 5 --messages 10
```

#### æ–¹å¼äºŒï¼šä¸€éµå•Ÿå‹•è…³æœ¬ï¼ˆWindowsï¼‰

å‰µå»º `start-all.bat`ï¼š

```batch
@echo off
start "å¾Œç«¯ä¼ºæœå™¨" cmd /k "npm start"
timeout /t 3
start "å‰ç«¯é–‹ç™¼ä¼ºæœå™¨" cmd /k "cd frontend && npm run dev"
timeout /t 3
start "æ¨¡æ“¬å™¨" cmd /k "python tests/simulator_backend.py --continuous"
```

### é©—è­‰ç³»çµ±é‹è¡Œ

**1. æª¢æŸ¥å¾Œç«¯å¥åº·ç‹€æ…‹**

```bash
curl http://localhost:3000/health
```

**é æœŸå›æ‡‰ï¼š**
```json
{
  "status": "healthy",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "uptime": 123.45
}
```

**2. æª¢æŸ¥å‰ç«¯é€£æ¥**

æ‰“é–‹ç€è¦½å™¨è¨ªå• `http://localhost:5173`ï¼Œå³ä¸Šè§’æ‡‰é¡¯ç¤ºã€Œâœ… å·²é€£æ¥ã€

**3. æª¢æŸ¥æ¨¡æ“¬å™¨**

æ¨¡æ“¬å™¨æ§åˆ¶å°æ‡‰é¡¯ç¤ºï¼š
```
ğŸš€ é–‹å§‹æ¨¡æ“¬å™¨æ¸¬è©¦
ğŸ“¡ å¾Œç«¯ URL: http://localhost:3000
ğŸ”„ æ¨¡å¼: æŒçºŒé‹è¡Œï¼ˆè‡ªå‹•ç”Ÿæˆæ•¸æ“šï¼‰
```

---

## API æ–‡æª”

### åŸºç¤è³‡è¨Š

- **Base URL**: `http://localhost:3000`
- **Content-Type**: `application/json`

### æ„Ÿæ¸¬å™¨æ•¸æ“š API

#### ä¸Šå‚³æ„Ÿæ¸¬å™¨æ•¸æ“š

```
POST /api/sensors/data
```

**è«‹æ±‚é«”ç¯„ä¾‹ï¼š**
```json
{
  "nodeId": "S-001",
  "dataImportance": 8.5,
  "battery": 75.0,
  "timestamp": "2024-01-15T10:30:00.000Z",
  "networkStatus": "good",
  "sensorType": "temperature",
  "value": 25.5,
  "unit": "celsius",
  "periodic": {
    "temperature": 25.5,
    "humidity": 65.2,
    "rain_prob": 0.3,
    "wind_speed": 5.2,
    "wind_dir": "E",
    "pressure": 1013.5,
    "AQI": 45,
    "noise": 55,
    "traffic": "MEDIUM",
    "notice": "none"
  },
  "emergency": null,
  "metadata": {
    "personal_id": "uuid-string",
    "scenario_id": "baseline",
    "send_unix": 1705312200.123
  }
}
```

**å¿…å¡«æ¬„ä½ï¼š**
- `nodeId`: ç¯€é» IDï¼ˆå­—ä¸²ï¼‰
- `dataImportance`: è³‡æ–™é‡è¦æ€§ï¼ˆ0-10 çš„æ•¸å­—ï¼‰
- `battery`: é›»é‡ï¼ˆ0-100 çš„æ•¸å­—ï¼‰

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ„Ÿæ¸¬å™¨æ•¸æ“šä¸Šå‚³æˆåŠŸ",
  "data": {
    "id": "sensor-1",
    "nodeId": "S-001",
    "priority": {
      "priorityScore": 7.85,
      "priorityLevel": "high",
      "breakdown": { ... }
    },
    "scheduleResult": {
      "scheduled": true,
      "queueType": "preemptive",
      "priority": "high"
    }
  }
}
```

#### ç²å–æ‰€æœ‰æ„Ÿæ¸¬å™¨æ•¸æ“š

```
GET /api/sensors/data
```

**æŸ¥è©¢åƒæ•¸ï¼š**
- `limit`: é™åˆ¶è¿”å›æ•¸é‡ï¼ˆæ•¸å­—ï¼‰
- `offset`: åç§»é‡ï¼ˆæ•¸å­—ï¼‰
- `nodeId`: ç¯©é¸ç‰¹å®šç¯€é»ï¼ˆå­—ä¸²ï¼‰
- `sensorType`: ç¯©é¸ç‰¹å®šæ„Ÿæ¸¬å™¨é¡å‹ï¼ˆå­—ä¸²ï¼‰
- `priorityLevel`: ç¯©é¸å„ªå…ˆç´šç­‰ç´šï¼ˆcritical, high, medium, lowï¼‰
- `minPriorityScore`: æœ€å°å„ªå…ˆç´šåˆ†æ•¸ï¼ˆ0-10ï¼‰
- `sortBy`: æ’åºæ–¹å¼ï¼ˆpriority, timestampï¼‰

**ç¯„ä¾‹ï¼š**
```bash
# æŒ‰å„ªå…ˆç´šæ’åºï¼Œé™åˆ¶ 10 ç­†
GET /api/sensors/data?sortBy=priority&limit=10

# ç¯©é¸é«˜å„ªå…ˆç´šæ•¸æ“š
GET /api/sensors/data?priorityLevel=high

# åˆ†é æŸ¥è©¢
GET /api/sensors/data?limit=20&offset=0
```

#### ç²å–ç‰¹å®šæ„Ÿæ¸¬å™¨æ•¸æ“š

```
GET /api/sensors/data/:id
```

#### ç²å–ç¯€é»æ•¸æ“š

```
GET /api/sensors/node/:nodeId
```

#### ç²å–å„ªå…ˆç´šçµ±è¨ˆ

```
GET /api/sensors/priority/stats
```

### å ±è¡¨ API

#### ç²å–æ•¸æ“šæ‘˜è¦

```
GET /api/reports/summary
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "totalRecords": 100,
    "uniqueNodes": 5,
    "nodeList": ["S-001", "S-002"],
    "sensorTypes": {
      "temperature": 20,
      "humidity": 20
    },
    "averageBattery": 72.5,
    "averageImportance": 6.8,
    "networkStatus": {
      "good": 80,
      "fair": 15
    },
    "latestTimestamp": "2024-01-15T10:30:00.000Z"
  }
}
```

#### ç²å–çµ±è¨ˆæ•¸æ“š

```
GET /api/reports/statistics?timeRange=all
```

**æ™‚é–“ç¯„åœé¸é …ï¼š**
- `today`: ä»Šå¤©
- `week`: æœ€è¿‘ä¸€é€±
- `month`: æœ€è¿‘ä¸€å€‹æœˆ
- `all`: å…¨éƒ¨ï¼ˆé è¨­ï¼‰

### èª¿åº¦å™¨ API

#### ç²å–ä¸Šå‚³ä½‡åˆ—ç‹€æ…‹

```
GET /api/scheduler/queue
```

#### æ‰‹å‹•è§¸ç™¼ç·Šæ€¥ä½‡åˆ—è™•ç†

```
POST /api/scheduler/process-critical
```

#### æ‰‹å‹•è§¸ç™¼æ‰¹æ¬¡ä½‡åˆ—è™•ç†

```
POST /api/scheduler/process-batch
```

#### æ¸…ç©ºæ‰€æœ‰ä½‡åˆ—

```
DELETE /api/scheduler/queue
```

### æ•ˆèƒ½ç›£æ§ API

#### ç²å–æ•ˆèƒ½çµ±è¨ˆ

```
GET /api/performance/stats
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "performance": {
    "totalRequests": 1000,
    "averageResponseTime": 45.2,
    "p50": 38.5,
    "p95": 89.3,
    "p99": 125.7
  },
  "cache": {
    "hits": 750,
    "misses": 250,
    "hitRate": "75.00%",
    "size": 50
  },
  "asyncQueue": {
    "queueLength": 0,
    "isProcessing": false
  }
}
```

#### é‡ç½®æ•ˆèƒ½çµ±è¨ˆ

```
POST /api/performance/reset
```

---

## ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šä¸Šå‚³æ„Ÿæ¸¬å™¨æ•¸æ“š

```bash
curl -X POST http://localhost:3000/api/sensors/data \
  -H "Content-Type: application/json" \
  -d '{
    "nodeId": "S-001",
    "dataImportance": 8.5,
    "battery": 75.0,
    "networkStatus": "good",
    "sensorType": "temperature",
    "value": 25.5,
    "periodic": {
      "temperature": 25.5,
      "humidity": 65.2,
      "AQI": 45
    }
  }'
```

### ç¯„ä¾‹ 2ï¼šæŸ¥è©¢é«˜å„ªå…ˆç´šæ•¸æ“š

```bash
curl "http://localhost:3000/api/sensors/data?priorityLevel=high&sortBy=priority&limit=10"
```

### ç¯„ä¾‹ 3ï¼šç²å–ç³»çµ±çµ±è¨ˆ

```bash
# ç²å–æ‘˜è¦
curl http://localhost:3000/api/reports/summary

# ç²å–æ•ˆèƒ½çµ±è¨ˆ
curl http://localhost:3000/api/performance/stats
```

### ç¯„ä¾‹ 4ï¼šä½¿ç”¨æ¨¡æ“¬å™¨

```bash
# æŒçºŒé‹è¡Œæ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
python tests/simulator_backend.py --continuous

# è‡ªè¨‚åƒæ•¸
python tests/simulator_backend.py --continuous \
  --sensors 10 \
  --interval 1.0 \
  --scenario baseline \
  --duration 300
```

---

## æ•ˆèƒ½å„ªåŒ–

### å„ªåŒ–åŠŸèƒ½

ç³»çµ±å·²å¯¦ä½œä»¥ä¸‹æ•ˆèƒ½å„ªåŒ–ï¼š

1. **å¿«å–æ©Ÿåˆ¶**
   - è¨˜æ†¶é«”å¿«å–æ¸›å°‘é‡è¤‡æŸ¥è©¢
   - è‡ªå‹•éæœŸæ©Ÿåˆ¶ï¼ˆTTLï¼‰
   - å¿«å–å‘½ä¸­ç‡ç›£æ§

2. **éåŒæ­¥è™•ç†**
   - å„ªå…ˆç´šè¨ˆç®—ä¸é˜»å¡ä¸»ç·šç¨‹
   - ä»»å‹™ä½‡åˆ—ç®¡ç†
   - æ‰¹é‡ä¸¦è¡Œè™•ç†

3. **æ¼”ç®—æ³•å„ªåŒ–**
   - æ¸›å°‘å‡½æ•¸èª¿ç”¨é–‹éŠ·
   - ç›´æ¥è¨ˆç®—å„ªåŒ–
   - å–®æ¬¡éæ­·çµ±è¨ˆ

### æ•ˆèƒ½æ¸¬è©¦

```bash
# åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
npm run test:performance

# æŸ¥çœ‹æ•ˆèƒ½çµ±è¨ˆ
curl http://localhost:3000/api/performance/stats
```

### é æœŸæ•ˆæœ

- **å›æ‡‰æ™‚é–“é™ä½ 30% ä»¥ä¸Š**
- **å¿«å–å‘½ä¸­ç‡ 70% ä»¥ä¸Š**
- **ååé‡æå‡**
- **CPU ä½¿ç”¨ç‡é™ä½**

è©³ç´°èªªæ˜è«‹æŸ¥çœ‹ [æ•ˆèƒ½å„ªåŒ–æ–‡æª”](docs/performance-optimization.md)

---

## ç³»çµ±ä¿®å¾©èªªæ˜

### âœ… å·²ä¿®å¾©çš„å•é¡Œ

#### 1. è³‡æ–™åº«æŒä¹…åŒ–ï¼ˆè§£æ±ºã€Œé‡‘é­šè…¦ã€å•é¡Œï¼‰

**å•é¡Œï¼š** ä½¿ç”¨è¨˜æ†¶é«”é™£åˆ—ï¼Œé‡å•Ÿå¾Œè³‡æ–™å…¨éƒ¨æ¶ˆå¤±

**è§£æ±ºæ–¹æ¡ˆï¼š**
- âœ… å¯¦ä½œ `services/databaseService.js` ä½¿ç”¨ JSON æª”æ¡ˆæŒä¹…åŒ–
- âœ… è³‡æ–™å„²å­˜åœ¨ `data/sensor-data.json`
- âœ… é‡å•Ÿä¼ºæœå™¨å¾Œè³‡æ–™ä¸æœƒæ¶ˆå¤±

**é©—è­‰æ–¹å¼ï¼š**
```bash
# 1. ä¸Šå‚³æ•¸æ“š
python tests/simulator_backend.py --sensors 3 --messages 5

# 2. é‡å•Ÿä¼ºæœå™¨
# åœæ­¢ä¼ºæœå™¨ï¼ˆCtrl+Cï¼‰ï¼Œç„¶å¾Œé‡æ–°å•Ÿå‹•

# 3. æŸ¥è©¢æ•¸æ“šï¼ˆæ‡‰è©²é‚„åœ¨ï¼‰
curl http://localhost:3000/api/sensors/data
```

#### 2. çœŸæ­£çš„å„ªå…ˆç´šä½‡åˆ—ï¼ˆè§£æ±ºã€ŒVIP é€šé“æ˜¯å‡çš„ã€å•é¡Œï¼‰

**å•é¡Œï¼š** é›–ç„¶è¨ˆç®—äº†å„ªå…ˆç´šï¼Œä½†å„²å­˜æ™‚åªæ˜¯ç°¡å–® `push()`ï¼Œæ²’æœ‰æŒ‰å„ªå…ˆç´šæ’åº

**è§£æ±ºæ–¹æ¡ˆï¼š**
- âœ… è³‡æ–™åº«æœå‹™åœ¨æ’å…¥æ™‚æŒ‰ `PriorityScore` é™åºæ’åº
- âœ… é«˜å„ªå…ˆç´šæ•¸æ“šè‡ªå‹•æ’å…¥åˆ°å‰é¢
- âœ… ä½¿ç”¨å…¬å¼ï¼š`PriorityScore = W_imp Ã— Importance + W_bat Ã— (100 - Battery)/10 + W_net Ã— Network`

**é©—è­‰æ–¹å¼ï¼š**
```bash
# ä¸Šå‚³ä¸åŒå„ªå…ˆç´šçš„æ•¸æ“š
curl -X POST http://localhost:3000/api/sensors/data \
  -H "Content-Type: application/json" \
  -d '{"nodeId":"S-HIGH","dataImportance":9,"battery":10,"networkStatus":"good"}'

curl -X POST http://localhost:3000/api/sensors/data \
  -H "Content-Type: application/json" \
  -d '{"nodeId":"S-LOW","dataImportance":2,"battery":90,"networkStatus":"excellent"}'

# æŸ¥è©¢æ•¸æ“šï¼ˆæ‡‰è©²æŒ‰å„ªå…ˆç´šæ’åºï¼‰
curl "http://localhost:3000/api/sensors/data?sortBy=priority"
# ç¬¬ä¸€å€‹æ‡‰è©²æ˜¯ S-HIGHï¼ˆé«˜å„ªå…ˆç´šï¼‰
```

#### 3. å‰ç«¯å¾Œç«¯é€£æ¥ï¼ˆå·²è§£æ±ºï¼‰

**å•é¡Œï¼š** å‰ç«¯é€£ Firebaseï¼Œå¾Œç«¯ç”¨è¨˜æ†¶é«”ï¼Œå…©è€…æ²’é€£æ¥

**ç¾ç‹€ï¼š** âœ… å·²è§£æ±º
- å‰ç«¯ `App.jsx` å·²æ”¹ç‚ºé€£æ¥å¾Œç«¯ API
- æ²’æœ‰ Firebase ç›¸é—œä»£ç¢¼
- å‰ç«¯ä½¿ç”¨ `fetch()` å¾å¾Œç«¯ç²å–æ•¸æ“š

#### 4. æ¨¡æ“¬å™¨çœŸå¯¦ç™¼é€ï¼ˆå·²è§£æ±ºï¼‰

**å•é¡Œï¼š** èˆŠçš„ `simulator.py` åªæ˜¯å‡ç™¼é€

**ç¾ç‹€ï¼š** âœ… å·²è§£æ±º
- `simulator_backend.py` ä½¿ç”¨ `requests.post()` çœŸå¯¦ç™¼é€ HTTP è«‹æ±‚
- é€£æ¥åˆ° `http://localhost:3000/api/sensors/data`

### è³‡æ–™åº« API

- `GET /api/database/stats` - ç²å–è³‡æ–™åº«çµ±è¨ˆ
- `DELETE /api/database/clear` - æ¸…ç©ºè³‡æ–™åº«ï¼ˆåƒ…ç”¨æ–¼æ¸¬è©¦ï¼‰

### è³‡æ–™åº«æª”æ¡ˆ

- **ä½ç½®**: `data/sensor-data.json`
- **æ ¼å¼**: JSON
- **è‡ªå‹•å‚™ä»½**: å»ºè­°å®šæœŸå‚™ä»½ `data/` ç›®éŒ„

è©³ç´°èªªæ˜è«‹æŸ¥çœ‹ [ä¿®å¾©ç¸½çµ](docs/fixes-summary.md)

---

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. å¾Œç«¯ç„¡æ³•å•Ÿå‹•

**å•é¡Œï¼š** `Error: listen EADDRINUSE: address already in use`

**è§£æ±ºï¼š**
```bash
# Windows: æŸ¥æ‰¾å ç”¨ç«¯å£çš„é€²ç¨‹
netstat -ano | findstr :3000

# çµ‚æ­¢é€²ç¨‹ï¼ˆæ›¿æ› PIDï¼‰
taskkill /PID <PID> /F

# æˆ–ä¿®æ”¹ç«¯å£
# åœ¨ .env æ–‡ä»¶ä¸­è¨­å®š PORT=3001
```

#### 2. å‰ç«¯ç„¡æ³•é€£æ¥å¾Œç«¯

**å•é¡Œï¼š** `ERR_CONNECTION_REFUSED`

**è§£æ±ºï¼š**
1. ç¢ºèªå¾Œç«¯å·²å•Ÿå‹•ï¼šè¨ªå• `http://localhost:3000/health`
2. æª¢æŸ¥ CORS è¨­å®š
3. ç¢ºèªå‰ç«¯ API_BASE_URL è¨­å®šæ­£ç¢º

#### 3. æ¨¡æ“¬å™¨é€£æ¥å¤±æ•—

**å•é¡Œï¼š** `Connection refused` æˆ– `ç„¡æ³•é€£æ¥`

**è§£æ±ºï¼š**
1. ç¢ºèªå¾Œç«¯ä¼ºæœå™¨å·²å•Ÿå‹•
2. æª¢æŸ¥å¾Œç«¯ URL æ˜¯å¦æ­£ç¢º
3. æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
4. ç¢ºèª Python requests å¥—ä»¶å·²å®‰è£

#### 4. æ•¸æ“šæ ¼å¼éŒ¯èª¤

**å•é¡Œï¼š** `400 Bad Request` æˆ–é©—è­‰éŒ¯èª¤

**è§£æ±ºï¼š**
1. ç¢ºèªå¿…å¡«æ¬„ä½ï¼š`nodeId`, `dataImportance`, `battery`
2. ç¢ºèªæ•¸æ“šç¯„åœï¼š
   - `dataImportance`: 0-10
   - `battery`: 0-100
3. æª¢æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¢º

#### 5. å¿«å–å•é¡Œ

**å•é¡Œï¼š** æ•¸æ“šæœªæ›´æ–°

**è§£æ±ºï¼š**
```bash
# æŸ¥çœ‹å¿«å–çµ±è¨ˆ
curl http://localhost:3000/api/performance/stats

# å¿«å–æœƒè‡ªå‹•éæœŸï¼Œæˆ–ç­‰å¾… 30 ç§’å¾Œé‡è©¦
```

### æ—¥èªŒæª¢æŸ¥

**å¾Œç«¯æ—¥èªŒï¼š**
- æŸ¥çœ‹æ§åˆ¶å°è¼¸å‡º
- æª¢æŸ¥éŒ¯èª¤è¨Šæ¯
- ç¢ºèªè«‹æ±‚æ—¥èªŒ

**å‰ç«¯æ—¥èªŒï¼š**
- æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
- æŸ¥çœ‹ Console æ¨™ç±¤
- æª¢æŸ¥ Network æ¨™ç±¤çš„è«‹æ±‚ç‹€æ…‹

---

## é–‹ç™¼æŒ‡å—

### å°ˆæ¡ˆçµæ§‹

```
.
â”œâ”€â”€ server.js                 # ä¸»ä¼ºæœå™¨æª”æ¡ˆ
â”œâ”€â”€ controllers/              # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ sensorController.js   # æ„Ÿæ¸¬å™¨æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ reportController.js   # å ±è¡¨æ§åˆ¶å™¨
â”‚   â””â”€â”€ schedulerController.js # èª¿åº¦å™¨æ§åˆ¶å™¨
â”œâ”€â”€ services/                 # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”œâ”€â”€ sensorService.js      # æ„Ÿæ¸¬å™¨æœå‹™
â”‚   â”œâ”€â”€ reportService.js      # å ±è¡¨æœå‹™
â”‚   â”œâ”€â”€ priorityEngine.js     # å„ªå…ˆç´šåˆ¤å®šå¼•æ“
â”‚   â”œâ”€â”€ uploadScheduler.js    # ä¸Šå‚³èª¿åº¦å™¨
â”‚   â”œâ”€â”€ cacheService.js       # å¿«å–æœå‹™
â”‚   â””â”€â”€ asyncProcessor.js     # éåŒæ­¥è™•ç†æœå‹™
â”œâ”€â”€ routes/                   # è·¯ç”±å®šç¾©
â”‚   â”œâ”€â”€ sensorRoutes.js       # æ„Ÿæ¸¬å™¨è·¯ç”±
â”‚   â”œâ”€â”€ reportRoutes.js       # å ±è¡¨è·¯ç”±
â”‚   â””â”€â”€ schedulerRoutes.js    # èª¿åº¦å™¨è·¯ç”±
â”œâ”€â”€ middleware/               # ä¸­é–“ä»¶
â”‚   â””â”€â”€ performanceMonitor.js # æ•ˆèƒ½ç›£æ§
â”œâ”€â”€ frontend/                 # å‰ç«¯æ‡‰ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx           # ä¸»æ‡‰ç”¨ç¨‹å¼
â”‚   â”‚   â””â”€â”€ main.jsx          # å…¥å£é»
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ tests/                    # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ api.test.js           # API æ¸¬è©¦
â”‚   â”œâ”€â”€ performance-test.js  # æ•ˆèƒ½æ¸¬è©¦
â”‚   â””â”€â”€ simulator_backend.py  # æ•¸æ“šæ¨¡æ“¬å™¨
â””â”€â”€ docs/                     # æ–‡æª”
    â”œâ”€â”€ api-specification.md  # API è¦ç¯„
    â”œâ”€â”€ connection-guide.md   # é€£æ¥æŒ‡å—
    â””â”€â”€ performance-optimization.md # æ•ˆèƒ½å„ªåŒ–
```

### é–‹ç™¼å‘½ä»¤

```bash
# å¾Œç«¯é–‹ç™¼ï¼ˆè‡ªå‹•é‡å•Ÿï¼‰
npm run dev

# å‰ç«¯é–‹ç™¼ï¼ˆç†±é‡è¼‰ï¼‰
cd frontend && npm run dev

# åŸ·è¡Œæ¸¬è©¦
npm test

# åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
npm run test:performance

# æ§‹å»ºå‰ç«¯
cd frontend && npm run build
```

### ç¨‹å¼ç¢¼è¦ç¯„

- ä½¿ç”¨ ES6+ èªæ³•
- éµå¾ª RESTful API è¨­è¨ˆåŸå‰‡
- çµ±ä¸€éŒ¯èª¤è™•ç†æ ¼å¼
- æ·»åŠ é©ç•¶çš„è¨»é‡‹

### æ¸¬è©¦

```bash
# API åŠŸèƒ½æ¸¬è©¦
npm test

# æ•ˆèƒ½æ¸¬è©¦
npm run test:performance

# é€£æ¥æ¸¬è©¦
node test-connection.js
```

---

## é€²éšåŠŸèƒ½

### ç’°å¢ƒè®Šæ•¸é…ç½®

å‰µå»º `.env` æ–‡ä»¶ï¼š

```env
# ä¼ºæœå™¨è¨­å®š
PORT=3000
NODE_ENV=development

# å‰ç«¯ API åŸºç¤ URLï¼ˆå‰ç«¯ä½¿ç”¨ï¼‰
VITE_API_BASE_URL=http://localhost:3000
```

### è‡ªè¨‚é…ç½®

**ä¿®æ”¹å¾Œç«¯ç«¯å£ï¼š**
```env
PORT=3001
```

**ä¿®æ”¹å‰ç«¯ç«¯å£ï¼š**
ç·¨è¼¯ `frontend/vite.config.js`ï¼š
```javascript
server: {
  port: 5174
}
```

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

**1. æ§‹å»ºå‰ç«¯**
```bash
cd frontend
npm run build
```

**2. ä½¿ç”¨ PM2 ç®¡ç†å¾Œç«¯**
```bash
npm install -g pm2
pm2 start server.js --name sensor-platform
```

**3. ä½¿ç”¨ Nginx åå‘ä»£ç†**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
    }
}
```

---

## ç³»çµ±ä¿®å¾©èªªæ˜

### å·²ä¿®å¾©çš„å•é¡Œ

1. **âœ… è³‡æ–™åº«æŒä¹…åŒ–** - ä½¿ç”¨ JSON æª”æ¡ˆå–ä»£è¨˜æ†¶é«”å„²å­˜ï¼Œé‡å•Ÿå¾Œè³‡æ–™ä¸æœƒæ¶ˆå¤±
2. **âœ… çœŸæ­£çš„å„ªå…ˆç´šä½‡åˆ—** - æ•¸æ“šæŒ‰ PriorityScore é™åºæ’å…¥ï¼Œé«˜å„ªå…ˆç´šæ•¸æ“šå„ªå…ˆè™•ç†
3. **âœ… å‰ç«¯å¾Œç«¯é€£æ¥** - å‰ç«¯å·²é€£æ¥å¾Œç«¯ APIï¼Œä¸å†ä½¿ç”¨ Firebase
4. **âœ… æ¨¡æ“¬å™¨çœŸå¯¦ç™¼é€** - æ¨¡æ“¬å™¨ä½¿ç”¨ requests çœŸå¯¦ç™¼é€ HTTP è«‹æ±‚

è©³ç´°èªªæ˜è«‹æŸ¥çœ‹ [ä¿®å¾©ç¸½çµ](docs/fixes-summary.md)

## ç›¸é—œæ–‡æª”

- [API è¦ç¯„](docs/api-specification.md) - è©³ç´°çš„ API æ ¼å¼è¦ç¯„
- [é€£æ¥æŒ‡å—](docs/connection-guide.md) - å‰ç«¯ã€æ¨¡æ“¬å™¨ã€å¾Œç«¯é€£æ¥èªªæ˜
- [æ¨¡æ“¬å™¨ä½¿ç”¨æŒ‡å—](docs/simulator-guide.md) - æ¨¡æ“¬å™¨è©³ç´°ä½¿ç”¨èªªæ˜
- [æ•ˆèƒ½å„ªåŒ–æ–‡æª”](docs/performance-optimization.md) - æ•ˆèƒ½å„ªåŒ–è©³ç´°èªªæ˜
- [ä¿®å¾©ç¸½çµ](docs/fixes-summary.md) - ç³»çµ±ä¿®å¾©è©³ç´°èªªæ˜

---

## æˆæ¬Š

ISC

---

## æ”¯æ´èˆ‡å›é¥‹

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹æŸ¥çœ‹ç›¸é—œæ–‡æª”æˆ–æª¢æŸ¥æ—¥èªŒè¼¸å‡ºã€‚

**æœ€å¾Œæ›´æ–°ï¼š** 2024-01-15
